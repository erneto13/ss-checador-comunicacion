<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:ChecadorComunicacion.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="450"
             x:DataType="vm:ReportesViewModel"
             x:Class="ChecadorComunicacion.Views.ReportesView">

    <UserControl.DataContext>
        <vm:ReportesViewModel />
    </UserControl.DataContext>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Panel de Filtros -->
        <Border Grid.Row="0"
                Background="#F5F5F5"
                CornerRadius="8"
                Padding="20"
                Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="Filtros de Reporte"
                           FontSize="18"
                           FontWeight="Bold"
                           Margin="0,0,0,15" />

                <Grid ColumnDefinitions="*,*,*,*,Auto">
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="Fecha Inicio:"
                                   FontWeight="Medium"
                                   Margin="0,0,0,5" />
                        <DatePicker SelectedDate="{Binding FechaInicio}"
                                    Width="300" />
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="-200,0, 0, 0">
                        <TextBlock Text="Fecha Fin:"
                                   FontWeight="Medium"
                                   Margin="0,0,0,5" />
                        <DatePicker SelectedDate="{Binding FechaFin}"
                                    Width="300" />
                    </StackPanel>

                    <StackPanel Grid.Column="3" Margin="-150,0,0,0">
                        <TextBlock Text="Tipo de Persona:"
                                   FontWeight="Medium"
                                   Margin="0,0,0,5" />
                        <ComboBox ItemsSource="{Binding TiposPersona}"
                                  SelectedItem="{Binding TipoPersonaSeleccionado}"
                                  Width="150" />
                    </StackPanel>

                    <StackPanel Grid.Column="3"
                                Orientation="Horizontal"
                                VerticalAlignment="Bottom"
                                Margin="20,0,0,0">
                        <Button Content="Generar Reporte"
                                Command="{Binding GenerarReporteCommand}"
                                Background="#2563EB"
                                Foreground="White"
                                Margin="0,0,10,0"
                                Padding="15,8" />

                        <Button
                            Command="{Binding ExportarCommand}"
                            Background="#059669"
                            Foreground="White"
                            Margin="0,0,10,0"
                            Padding="15,8">
                            <PathIcon Data="{StaticResource Export}" />
                        </Button>

                        <Button
                            Command="{Binding LimpiarCommand}"
                            Background="#DC2626"
                            Foreground="White"
                            Padding="15,8">
                            <PathIcon Data="{StaticResource Delete}" />
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Mensaje de Error -->
                <TextBlock Text="{Binding MensajeError}"
                           IsVisible="{Binding MensajeError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           Foreground="#DC2626"
                           FontWeight="Medium"
                           Margin="0,10,0,0"
                           TextWrapping="Wrap" />
            </StackPanel>
        </Border>

        <!-- Loading Indicator -->
        <Grid Grid.Row="1"
              IsVisible="{Binding IsLoading}"
              Background="#80FFFFFF">
            <StackPanel VerticalAlignment="Center"
                        HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True"
                             Width="200"
                             Height="4"
                             Margin="0,0,0,10" />
                <TextBlock Text="Generando reporte..."
                           HorizontalAlignment="Center"
                           FontWeight="Medium" />
            </StackPanel>
        </Grid>

        <!-- DataGrid de Resultados -->
        <DataGrid Grid.Row="1"
                  ItemsSource="{Binding Reportes}"
                  IsVisible="{Binding !IsLoading}"
                  AutoGenerateColumns="False"
                  CanUserReorderColumns="True"
                  CanUserResizeColumns="True"
                  CanUserSortColumns="True"
                  GridLinesVisibility="All">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Fecha"
                                    Binding="{Binding Fecha, StringFormat=dd/MM/yyyy}"
                                    Width="100" />

                <DataGridTextColumn Header="Matrícula"
                                    Binding="{Binding Matricula}"
                                    Width="100" />

                <DataGridTextColumn Header="Nombre"
                                    Binding="{Binding Nombre}"
                                    Width="200" />

                <DataGridTextColumn Header="Tipo"
                                    Binding="{Binding TipoPersona}"
                                    Width="120" />

                <DataGridTextColumn Header="Entrada"
                                    Binding="{Binding HoraEntrada}"
                                    Width="80" />

                <DataGridTextColumn Header="Salida"
                                    Binding="{Binding HoraSalida}"
                                    Width="80" />

                <DataGridTextColumn Header="Horas"
                                    Binding="{Binding HorasTrabajadas, StringFormat=F2}"
                                    Width="80" />

            </DataGrid.Columns>
        </DataGrid>

        <!-- Panel de Estadísticas -->
        <Border Grid.Row="2"
                Background="#F8FAFC"
                BorderBrush="#E2E8F0"
                BorderThickness="1"
                CornerRadius="8"
                Padding="20"
                Margin="0,20,0,0">
            <Grid ColumnDefinitions="*,*,*,*">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding TotalRegistros}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#1F2937" />
                    <TextBlock Text="Total Registros"
                               FontSize="12"
                               Foreground="#6B7280" />
                </StackPanel>

                <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding PersonasUnicas}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#1F2937" />
                    <TextBlock Text="Personas Únicas"
                               FontSize="12"
                               Foreground="#6B7280" />
                </StackPanel>

                <StackPanel Grid.Column="2">
                    <TextBlock Text="{Binding TotalHoras, StringFormat=F2}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#1F2937" />
                    <TextBlock Text="Total Horas"
                               FontSize="12"
                               Foreground="#6B7280" />
                </StackPanel>

                <StackPanel Grid.Column="3">
                    <TextBlock Text="{Binding PromedioHorasPorDia, StringFormat=F2}"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="#1F2937" />
                    <TextBlock Text="Promedio Horas/Día"
                               FontSize="12"
                               Foreground="#6B7280" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>

</UserControl>